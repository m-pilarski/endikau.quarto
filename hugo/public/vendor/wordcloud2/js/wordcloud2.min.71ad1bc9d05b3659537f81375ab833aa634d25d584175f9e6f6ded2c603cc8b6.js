/*!
 * wordcloud2.js
 * http://timdream.org/wordcloud2.js/
 *
 * Copyright 2011 - 2019 Tim Guan-tin Chien and contributors.
 * Released under the MIT license
 */"use strict";window.setImmediate||(window.setImmediate=function(){return window.msSetImmediate||window.webkitSetImmediate||window.mozSetImmediate||window.oSetImmediate||function(){if(!window.postMessage||!window.addEventListener)return null;var t=[void 0],n="zero-timeout-message",s=function(s){var o=t.length;return t.push(s),window.postMessage(n+o.toString(36),"*"),o};return window.addEventListener("message",function(s){if(typeof s.data!="string"||s.data.substr(0,n.length)!==n)return;s.stopImmediatePropagation();var o=parseInt(s.data.substr(n.length),36);if(!t[o])return;t[o](),t[o]=void 0},!0),window.clearImmediate=function(n){if(!t[n])return;t[n]=void 0},s}()||function(t){window.setTimeout(t,0)}}()),window.clearImmediate||(window.clearImmediate=function(){return window.msClearImmediate||window.webkitClearImmediate||window.mozClearImmediate||window.oClearImmediate||function(t){window.clearTimeout(t)}}()),function(e){var s=function(){var t,n=document.createElement("canvas");return!!n&&!!n.getContext&&(t=n.getContext("2d"),!!t&&!!t.getImageData&&!!t.fillText&&!!Array.prototype.some&&!!Array.prototype.push)}(),o=function(){if(!s)return;for(var o,i,t=document.createElement("canvas").getContext("2d"),n=20;n;){if(t.font=n.toString(10)+"px sans-serif",t.measureText("Ｗ").width===o&&t.measureText("m").width===i)return n+1;o=t.measureText("Ｗ").width,i=t.measureText("m").width,n--}return 0}(),i=function(e){if(Array.isArray(e)){var t=e.slice();return t.splice(0,2),t}return[]},a=function(t){for(var s,o,n=t.length;n;)s=Math.floor(Math.random()*n),o=t[--n],t[n]=t[s],t[s]=o;return t},t={},n=function(n,r){if(!s)return;var c,l,d,u,h,f,p,g,v,b,j,y,_,w,O,x,C,E,k,A,S,M,F,T,z,D,N,L,R,P,H,I,B,V,W,m=Math.floor(Math.random()*Date.now());if(Array.isArray(n)||(n=[n]),n.forEach(function(e,t){if(typeof e=="string"){if(n[t]=document.getElementById(e),!n[t])throw new Error("The element id specified is not found.")}else if(!e.tagName&&!e.appendChild)throw new Error("You must pass valid HTML elements, or ID of the element.")}),c={list:[],fontFamily:'"Trebuchet MS", "Heiti TC", "微軟正黑體", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",minSize:0,weightFactor:1,clearCanvas:!0,backgroundColor:"#fff",gridSize:8,drawOutOfBound:!1,shrinkToFit:!1,origin:null,drawMask:!1,maskColor:"rgba(255,0,0,0.3)",maskGapWidth:.3,wait:0,abortThreshold:0,abort:function(){},minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,shuffle:!0,rotateRatio:.1,shape:"circle",ellipticity:.65,classes:null,hover:null,click:null},r)for(A in r)A in c&&(c[A]=r[A]);if(typeof c.weightFactor!="function"&&(L=c.weightFactor,c.weightFactor=function(t){return t*L}),typeof c.shape!="function")switch(c.shape){case"circle":default:c.shape="circle";break;case"cardioid":c.shape=function(t){return 1-Math.sin(t)};break;case"diamond":c.shape=function(t){var n=t%(2*Math.PI/4);return 1/(Math.cos(n)+Math.sin(n))};break;case"square":c.shape=function(t){return Math.min(1/Math.abs(Math.cos(t)),1/Math.abs(Math.sin(t)))};break;case"triangle-forward":c.shape=function(t){var n=t%(2*Math.PI/3);return 1/(Math.cos(n)+Math.sqrt(3)*Math.sin(n))};break;case"triangle":case"triangle-upright":c.shape=function(t){var n=(t+Math.PI*3/2)%(2*Math.PI/3);return 1/(Math.cos(n)+Math.sqrt(3)*Math.sin(n))};break;case"pentagon":c.shape=function(t){var n=(t+.955)%(2*Math.PI/5);return 1/(Math.cos(n)+.726543*Math.sin(n))};break;case"star":c.shape=function(t){var n=(t+.955)%(2*Math.PI/10);return(t+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-n)+3.07768*Math.sin(2*Math.PI/10-n)):1/(Math.cos(n)+3.07768*Math.sin(n))};break}c.gridSize=Math.max(Math.floor(c.gridSize),4),l=c.gridSize,T=l-c.maskGapWidth,C=Math.abs(c.maxRotation-c.minRotation),O=Math.abs(Math.floor(c.rotationSteps)),E=Math.min(c.maxRotation,c.minRotation);function $(e,t){return"hsl("+(Math.random()*360).toFixed()+","+(Math.random()*30+70).toFixed()+"%,"+(Math.random()*(t-e)+e).toFixed()+"%)"}switch(c.color){case"random-dark":v=function(){return $(10,50)};break;case"random-light":v=function(){return $(50,90)};break;default:typeof c.color=="function"&&(v=c.color);break}typeof c.fontWeight=="function"&&(g=c.fontWeight),j=null,typeof c.classes=="function"&&(j=c.classes),y=!1,p=[],M=function(t){var o,i,a,r,c,d,s=t.currentTarget,n=s.getBoundingClientRect();return t.touches?(o=t.touches[0].clientX,i=t.touches[0].clientY):(o=t.clientX,i=t.clientY),r=o-n.left,c=i-n.top,a=Math.floor(r*(s.width/n.width||1)/l),d=Math.floor(c*(s.height/n.height||1)/l),p[a]?p[a][d]:null},F=function(t){var n=M(t);if(S===n)return;if(S=n,!n){c.hover(void 0,void 0,t);return}c.hover(n.item,n.dimension,t)},k=function(t){var n=M(t);if(!n)return;c.click(n.item,n.dimension,t),t.preventDefault()},x=[],D=function(t){if(x[t])return x[t];var i,n=t*8,s=n,o=[];for(t===0&&o.push([b[0],b[1],0]);s--;)i=1,c.shape!=="circle"&&(i=c.shape(s/n*2*Math.PI)),o.push([b[0]+t*i*Math.cos(-s/n*2*Math.PI),b[1]+t*i*Math.sin(-s/n*2*Math.PI)*c.ellipticity,s/n*2*Math.PI]);return x[t]=o,o},w=function(){return c.abortThreshold>0&&(new Date).getTime()-N>c.abortThreshold},z=function(){return c.rotateRatio===0?0:Math.random()>c.rotateRatio?0:C===0?E:O>0?E+Math.floor(Math.random()*O)*C/(O-1):E+Math.random()*C},R=function(t,n,s,i){var a,r,d,u,h,f,p,v,b,j,y,O,x,C,E,k,A,S,M,F,T,z,D,_=!1,m=c.weightFactor(n);if(m<=c.minSize)return!1;if(r=1,m<o&&(r=function(){for(var t=2;t*m<o;)t+=2;return t}()),g?A=g(t,n,m,i):A=c.fontWeight,x=document.createElement("canvas"),a=x.getContext("2d",{willReadFrequently:!0}),a.font=A+" "+(m*r).toString(10)+"px "+c.fontFamily,b=a.measureText(t).width/r,v=Math.max(m*r,a.measureText("m").width,a.measureText("Ｗ").width)/r,y=b+v*2,j=v*3,D=Math.ceil(y/l),z=Math.ceil(j/l),y=D*l,j=z*l,C=-b/2,E=-v*.4,f=Math.ceil((y*Math.abs(Math.sin(s))+j*Math.abs(Math.cos(s)))/l),p=Math.ceil((y*Math.abs(Math.cos(s))+j*Math.abs(Math.sin(s)))/l),O=p*l,k=f*l,x.setAttribute("width",O),x.setAttribute("height",k),_&&(document.body.appendChild(x),a.save()),a.scale(1/r,1/r),a.translate(O*r/2,k*r/2),a.rotate(-s),a.font=A+" "+(m*r).toString(10)+"px "+c.fontFamily,a.fillStyle="#000",a.textBaseline="middle",a.fillText(t,C*r,(E+m*.5)*r),T=a.getImageData(0,0,O,k).data,w())return!1;for(_&&(a.strokeRect(C*r,E,b*r,v*r),a.restore()),S=[],h=p,d=[f/2,p/2,f/2,p/2];h--;)for(u=f;u--;){F=l;singleGridLoop:for(;F--;)for(M=l;M--;)if(T[((u*l+F)*O+(h*l+M))*4+3]){S.push([h,u]),h<d[3]&&(d[3]=h),h>d[1]&&(d[1]=h),u<d[0]&&(d[0]=u),u>d[2]&&(d[2]=u),_&&(a.fillStyle="rgba(255, 0, 0, 0.5)",a.fillRect(h*l,u*l,l-.5,l-.5));break singleGridLoop}_&&(a.fillStyle="rgba(0, 0, 255, 0.5)",a.fillRect(h*l,u*l,l-.5,l-.5))}return _&&(a.fillStyle="rgba(0, 255, 0, 0.5)",a.fillRect(d[3]*l,d[0]*l,(d[1]-d[3]+1)*l,(d[2]-d[0]+1)*l)),{mu:r,occupied:S,bounds:d,gw:p,gh:f,fillTextOffsetX:C,fillTextOffsetY:E,fillTextWidth:b,fillTextHeight:v,fontSize:m}},P=function(t,n,s,o,i){for(var a,r,l=i.length;l--;){if(a=t+i[l][0],r=n+i[l][1],a>=d||r>=u||a<0||r<0){if(!c.drawOutOfBound)return!1;continue}if(!h[a][r])return!1}return!0},H=function(t,s,o,i,a,r,d,u,h,m){var p,b,y,f=o.fontSize;v?p=v(i,a,f,r,d,m):p=c.color,g?b=g(i,a,f,m):b=c.fontWeight,j?y=j(i,a,f,m):y=c.classes,n.forEach(function(e){if(e.getContext){var r,d,m,g,v,n=e.getContext("2d"),a=o.mu;n.save(),n.scale(1/a,1/a),n.font=b+" "+(f*a).toString(10)+"px "+c.fontFamily,n.fillStyle=p,n.translate((t+o.gw/2)*l*a,(s+o.gh/2)*l*a),u!==0&&n.rotate(-u),n.textBaseline="middle",n.fillText(i,o.fillTextOffsetX*a,(o.fillTextOffsetY+f*.5)*a),n.restore()}else{r=document.createElement("span"),d="",d="rotate("+-u/Math.PI*180+"deg) ",o.mu!==1&&(d+="translateX(-"+o.fillTextWidth/4+"px) scale("+1/o.mu+")"),m={position:"absolute",display:"block",font:b+" "+f*o.mu+"px "+c.fontFamily,left:(t+o.gw/2)*l+o.fillTextOffsetX+"px",top:(s+o.gh/2)*l+o.fillTextOffsetY+"px",width:o.fillTextWidth+"px",height:o.fillTextHeight+"px",lineHeight:f+"px",whiteSpace:"nowrap",transform:d,webkitTransform:d,msTransform:d,transformOrigin:"50% 40%",webkitTransformOrigin:"50% 40%",msTransformOrigin:"50% 40%"},p&&(m.color=p),r.textContent=i;for(g in m)r.style[g]=m[g];if(h)for(v in h)r.setAttribute(v,h[v]);y&&(r.className+=y),e.appendChild(r)}})},I=function(t,s,o,i,a){if(t>=d||s>=u||t<0||s<0)return;if(h[t][s]=!1,o){var r=n[0].getContext("2d");r.fillRect(t*l,s*l,T,T)}y&&(p[t][s]={item:a,dimension:i})},B=function(t,s,o,i,a,r){var h,m,f,p,g,j,v=a.occupied,b=c.drawMask;for(b&&(m=n[0].getContext("2d"),m.save(),m.fillStyle=c.maskColor),y&&(h=a.bounds,j={x:(t+h[3])*l,y:(s+h[0])*l,w:(h[1]-h[3]+1)*l,h:(h[2]-h[0]+1)*l}),f=v.length;f--;){if(p=t+v[f][0],g=s+v[f][1],p>=d||g>=u||p<0||g<0)continue;I(p,g,b,j,r)}b&&m.restore()},V=function e(t){Array.isArray(t)?(r=t[0],l=t[1]):(r=t.word,l=t.weight,m=t.attributes);var s,o,r,l,h,m,g,v,f=z(),p=i(t),n=R(r,l,f,p);if(!n)return!1;if(w())return!1;if(!c.drawOutOfBound&&!c.shrinkToFit&&(s=n.bounds,s[1]-s[3]+1>d||s[2]-s[0]+1>u))return!1;for(h=_+1,g=function(e){var s=Math.floor(e[0]-n.gw/2),o=Math.floor(e[1]-n.gh/2),i=n.gw,a=n.gh;return!!P(s,o,i,a,n.occupied)&&(H(s,o,n,r,l,_-h,e[2],f,m,p),B(s,o,i,a,n,t),!0)};h--;)if(o=D(_-h),c.shuffle&&(o=[].concat(o),a(o)),v=o.some(g),v)return!0;return!!c.shrinkToFit&&(Array.isArray(t)?t[1]=t[1]*3/4:t.weight=t.weight*3/4,e(t))},f=function(t,s,o){if(s)return!n.some(function(e){var n=new CustomEvent(t,{detail:o||{}});return!e.dispatchEvent(n)},this);n.forEach(function(e){var n=new CustomEvent(t,{detail:o||{}});e.dispatchEvent(n)},this)},W=function(){var s,i,a,r,g,v,j,O,x,C,E,A,M,T,o=n[0];if(o.getContext?(d=Math.ceil(o.width/l),u=Math.ceil(o.height/l)):(M=o.getBoundingClientRect(),d=Math.ceil(M.width/l),u=Math.ceil(M.height/l)),!f("wordcloudstart",!0))return;if(b=c.origin?[c.origin[0]/l,c.origin[1]/l]:[d/2,u/2],_=Math.floor(Math.sqrt(d*d+u*u)),h=[],!o.getContext||c.clearCanvas)for(n.forEach(function(e){if(e.getContext){var t=e.getContext("2d");t.fillStyle=c.backgroundColor,t.clearRect(0,0,d*(l+1),u*(l+1)),t.fillRect(0,0,d*(l+1),u*(l+1))}else e.textContent="",e.style.backgroundColor=c.backgroundColor,e.style.position="relative"}),s=d;s--;)for(h[s]=[],i=u;i--;)h[s][i]=!0;else{for(r=document.createElement("canvas").getContext("2d"),r.fillStyle=c.backgroundColor,r.fillRect(0,0,1,1),x=r.getImageData(0,0,1,1).data,A=o.getContext("2d").getImageData(0,0,d*l,u*l).data,s=d;s--;)for(h[s]=[],i=u;i--;){C=l;singleGridLoop:for(;C--;)for(E=l;E--;)for(a=4;a--;)if(A[((i*l+C)*d*l+(s*l+E))*4+a]!==x[a]){h[s][i]=!1;break singleGridLoop}h[s][i]!==!1&&(h[s][i]=!0)}A=r=x=void 0}if(c.hover||c.click){for(y=!0,s=d+1;s--;)p[s]=[];c.hover&&o.addEventListener("mousemove",F),c.click&&(o.addEventListener("click",k),o.style.webkitTapHighlightColor="rgba(0, 0, 0, 0)"),o.addEventListener("wordcloudstart",function e(){o.removeEventListener("wordcloudstart",e),o.removeEventListener("mousemove",F),o.removeEventListener("click",k),S=void 0})}a=0,c.wait!==0?(v=window.setTimeout,g=window.clearTimeout):(v=window.setImmediate,g=window.clearImmediate),T=function(t,s){n.forEach(function(e){e.addEventListener(t,s)},this)},O=function(t,s){n.forEach(function(e){e.removeEventListener(t,s)},this)},j=function e(){O("wordcloudstart",e),g(t[m])},T("wordcloudstart",j),t[m]=v(function e(){if(a>=c.list.length){g(t[m]),f("wordcloudstop",!1),O("wordcloudstart",j),delete t[m];return}N=(new Date).getTime();var n=V(c.list[a]),s=!f("wordclouddrawn",!0,{item:c.list[a],drawn:n});if(w()||s){g(t[m]),c.abort(),f("wordcloudabort",!1),f("wordcloudstop",!1),O("wordcloudstart",j),delete t[m];return}a++,t[m]=v(e,c.wait)},c.wait)},W()};n.isSupported=s,n.minFontSize=o,n.stop=function(){if(t)for(var n in t)window.clearImmediate(t[n])},typeof define=="function"&&define.amd?(e.WordCloud=n,define("wordcloud",[],function(){return n})):typeof module!="undefined"&&module.exports?module.exports=n:e.WordCloud=n}(this)